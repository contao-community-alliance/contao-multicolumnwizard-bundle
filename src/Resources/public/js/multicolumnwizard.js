/*!
 * @name        contao-multicolumnwizard-bundle
 * @version     3.4.2-3-g9a86f53
 * @copyright   Andreas Schempp 2011
 * @copyright   certo web & design GmbH 2011
 * @copyright   MEN AT WORK 2013
 * @package     MultiColumnWizard
 * @license     LGPL-3.0-or-later
 * @file        main
 */!function(t){var e={};function n(a){if(e[a])return e[a].exports;var i=e[a]={i:a,l:!1,exports:{}};return t[a].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=t,n.c=e,n.d=function(t,e,a){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:a})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(n.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(a,i,function(e){return t[e]}.bind(null,i));return a},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=0)}([function(t,e,n){"use strict";n.r(e);n(1);var a=window.MultiColumnWizard=new Class({Implements:[Options],options:{table:null,maxCount:0,minCount:0,uniqueFields:[]},asyncBlock:!1,operationLoadCallbacks:[],operationClickCallbacks:[],operationUpdateCallbacks:[],initialize:function(t){this.setOptions(t),this.options.table=document.id(this.options.table),window.Backend&&Backend.getScrollOffset();var e=this;this.options.table.getElement("tbody").getChildren("tr").each((function(t,n){t.getChildren("td.operations a").each((function(n){var i=n.get("data-operations");a.operationLoadCallbacks[i]&&a.operationLoadCallbacks[i].each((function(a){a.pass([n,t],e)()})),e.operationLoadCallbacks[i]&&e.operationLoadCallbacks[i].each((function(a){a.pass([n,t],e)()}))}))})),this.updateOperations()},updateOperations:function(){var t=this;this.options.table.getElement("tbody").getChildren("tr").each((function(e,n){e.getChildren("td.operations a").each((function(i){var o=i.get("data-operations");i.removeEvents("click"),"move"===o&&t.dragAndDrop(e,i),a.operationClickCallbacks[o]&&a.operationClickCallbacks[o].each((function(n){i.addEvent("click",(function(a){a.preventDefault(),n.pass([i,e],t)()}))})),t.operationClickCallbacks[o]&&t.operationClickCallbacks[o].each((function(a){i.addEvent("click",(function(o){o.preventDefault(),a.pass([i,e],t)(),t.updateFields(n)}))})),i.addEvent("click",(function(n){n.preventDefault(),t.updateOperations.pass([i,e],t)()})),a.operationUpdateCallbacks[o]&&a.operationUpdateCallbacks[o].each((function(n){n.pass([i,e],t)()})),t.operationUpdateCallbacks[o]&&t.operationUpdateCallbacks[o].each((function(n){n.pass([i,e],t)()}))}))}))},updateRowAttributes:function(t,e){var n=!0,a=0,i=0,o=0,l=0;return e.getElements(".mcwUpdateFields *").each((function(e){if(e.hasClass("tl_modulewizard")&&e.hasClass("multicolumnwizard")&&(n=!1,a++,e.addClass("mcw_inner_"+a),o=e.getElement("tbody").getElement("tr").getElements("td.mcwUpdateFields").length,l=1),0===a||e.hasClass("tl_modulewizard")&&e.hasClass("multicolumnwizard")||null!==e.getParent(".mcw_inner_"+a)||0===--a&&(n=!0),e.hasClass("chzn-container"))e.destroy();else{if("string"==typeOf(e.getProperty("name"))){var r=e.getProperty("name"),s=r.match(/([^[\]]+)/g),c=null,d="";s.each((function(t,e){!isNaN(parseFloat(t))&&isFinite(t)&&(c=e)})),s.each((function(e,a){0===a?d+=e:a===c&&n?d+="["+t+"]":a!==c-2||n?a!==c||n?d+="["+e+"]":(d+="["+i+"]",i=l>0&&l%o==0?++i:i,l++):d+="["+t+"]"})),"[]"==r.substr(r.length-2)&&(d+="[]"),e.setProperty("name",d)}var p;if("string"==typeOf(e.getProperty("id")))(p=e.getProperty("id").match(/^(.+)_row[0-9]+_(.+)$/i))&&e.setProperty("id",p[1]+"_row"+t+"_"+p[2]);if("string"==typeOf(e.getProperty("onclick")))(p=e.getProperty("onclick").match(/^(.+)_row[0-9]+_(.+)$/i))&&e.setProperty("onclick",p[1]+"_row"+t+"_"+p[2]);if("string"==typeOf(e.getProperty("for")))(p=e.getProperty("for").match(/^(.+)_row[0-9]+_(.+)$/i))&&e.setProperty("for",p[1]+"_row"+t+"_"+p[2]);switch(e.nodeName.toUpperCase()){case"SELECT":e.hasClass("tl_chosen")&&new Chosen(e);break;case"INPUT":"none"==e.getStyle("display").toLowerCase()&&e.setStyle("display","inline"),"string"!=typeOf(e.getProperty("id"))&&e.destroy();break;case"SCRIPT":for(var u="",f=e.get("html").toString(),h=0,g=f.search(/_row[0-9]+_/i);g>0;)h=f.match(/(_row[0-9]+)+_/i)[0].length,u=u+f.substr(0,g)+"_row"+t+"_",g=(f=f.substr(g+h)).search(/_row[0-9]+_/i);e.set("html",u+f)}}})),e},dragAndDrop:function(t,e){new Sortables(t.getParent("table").getElement("tbody"),{constrain:!0,opacity:.6,handle:"a[data-operations=move]",onComplete:function(){t.getParent("table").getElement("tbody").getChildren("tr").each((function(t,e){var n=e--;this.updateRowAttributes(n,t)}),this)}.bind(this)})},addOperationLoadCallback:function(t,e){this.operationLoadCallbacks[t]||(this.operationLoadCallbacks[t]=[]),this.operationLoadCallbacks[t].include(e)},addOperationUpdateCallback:function(t,e){this.operationUpdateCallbacks[t]||(this.operationUpdateCallbacks[t]=[]),this.operationLoadCallbacks[t].include(e)},addOperationClickCallback:function(t,e){this.operationClickCallbacks[t]||(this.operationClickCallbacks[t]=[]),this.operationClickCallbacks[t].include(e)},killAllTinyMCE:function(t,e){var n=e.getParent(".multicolumnwizard");if(0!=n.getElements(".tinymce").length){var a=n.get("id"),i=new RegExp(a),o=new Array,l=0,r="editorId";tinymce.majorVersion>3&&(r="id"),tinymce.editors.each((function(t,e){null!=t[r].match(i)&&(o[l]=t[r],l++)})),o.each((function(t,e){try{var n=tinymce.get(t);$(n[r]).set("text",n.getContent()),n.remove()}catch(t){console.log(t)}})),n.getElements("span.mceEditor").each((function(t,e){t.dispose()})),n.getElements(".tinymce").each((function(t,e){t.getElements("script").each((function(t,e){t.dispose()}))}))}},reinitTinyMCE:function(t,e,n){var a=null;if(0!=(a=1!=n?e.getParent(".multicolumnwizard"):e).getElements(".tinymce").length){var i=a.getElements(".tinymce textarea"),o="mceAddControl";tinymce.majorVersion>3&&(o="mceAddEditor"),i.each((function(t,e){tinymce.execCommand(o,!1,t.get("id")),tinymce.get(t.get("id")).show(),$(t.get("id")).erase("required"),$(tinymce.get(t.get("id")).editorContainer).getElements("iframe")[0].set("title","MultiColumnWizard - TinyMCE")}))}},reinitStylect:function(){window.Stylect&&versionCompare("3.2.3")>=0&&($$(".styled_select").each((function(t,e){t.dispose()})),Stylect.convertSelects())}});Object.append(a,{operationLoadCallbacks:{},operationClickCallbacks:{},operationUpdateCallbacks:{},addOperationLoadCallback:function(t,e){a.operationLoadCallbacks[t]||(a.operationLoadCallbacks[t]=[]),a.operationLoadCallbacks[t].include(e)},addOperationUpdateCallback:function(t,e){a.operationUpdateCallbacks[t]||(a.operationUpdateCallbacks[t]=[]),a.operationUpdateCallbacks[t].include(e)},addOperationClickCallback:function(t,e){a.operationClickCallbacks[t]||(a.operationClickCallbacks[t]=[]),a.operationClickCallbacks[t].include(e)},insertNewElement:function(t,e){if(!0!==this.asyncBlock){this.asyncBlock=!0,t.addClass("rotate");for(var n=$(e).getParent(".tl_modulewizard.multicolumnwizard"),i=$(n).getAttribute("data-name"),o=$(n).getElements("tr"),l=0,r=0;r<o.length;r++)l=Math.max(l,$(o[r]).getAttribute("data-rowid"));var s=this;new Request.Contao({evalScripts:!1,onSuccess:function(n,i){t.removeClass("rotate");var o=new Element("div",{html:i.content});$(o).getElement("tr").inject(e,"after"),i.javascript&&Browser.exec(i.javascript),$(o).getElements("td.operations a").each((function(e){var n=e.get("data-operations");a.operationLoadCallbacks[n]&&a.operationLoadCallbacks[n].each((function(n){n.pass([e,t],s)()})),s.operationLoadCallbacks[n]&&s.operationLoadCallbacks[n].each((function(n){n.pass([e,t],s)()}))})),s.updateOperations(),s.asyncBlock=!1},onFailure:function(e){t.removeClass("rotate"),s.asyncBlock=!1}}).post({action:"mcwCreateNewRow",name:i,maxRowId:l,REQUEST_TOKEN:Contao.request_token})}},newUpdate:function(t,e){var n=e.getSiblings().length+1;this.options.maxCount>0&&n>=this.options.maxCount?t.setStyle("display","none"):t.setStyle("display","inline")},newClick:function(t,e){this.killAllTinyMCE(t,e);var n=e.getSiblings().length+1;if(0==this.options.maxCount||this.options.maxCount>0&&n<this.options.maxCount){var i=e.clone(!0,!0);i.getElements("input,select,textarea").each((function(t){a.clearElementValue(t)})),level=e.getAllPrevious().length,(i=this.updateRowAttributes(++level,i)).inject(e,"after"),i.getElements("a[data-operations]").each((function(t){$$(t).set("title",$$(t).getElement("img").get("alt")),new Tips.Contao($$(t).filter((function(t){return""!=t.title})),{offset:{x:0,y:26}})})),i.getElements("script").length>0&&i.getElements("script").each((function(t){Browser.exec(t.get("html"))}));var o=this;i.getAllNext().each((function(t){o.updateRowAttributes(++level,t)}))}this.reinitTinyMCE(t,e,!1),this.reinitStylect()},copyUpdate:function(t,e){var n=e.getSiblings().length+1;this.options.maxCount>0&&n>=this.options.maxCount?t.setStyle("display","none"):t.setStyle("display","inline")},copyClick:function(t,e){this.killAllTinyMCE(t,e);var n=e.getSiblings().length+1;if(0==this.options.maxCount||this.options.maxCount>0&&n<this.options.maxCount){var a=e.clone(!0,!0);level=e.getAllPrevious().length,(a=this.updateRowAttributes(++level,a)).inject(e,"after"),a.getElements("a[data-operations]").each((function(t){$$(t).set("title",$$(t).getElement("img").get("alt")),new Tips.Contao($$(t).filter((function(t){return""!=t.title})),{offset:{x:0,y:26}})})),a.getElements("script").length>0&&a.getElements("script").each((function(t){Browser.exec(t.get("html"))}));var i=this;a.getAllNext().each((function(t){i.updateRowAttributes(++level,t)}))}this.reinitTinyMCE(t,e,!1),this.reinitStylect()},deleteUpdate:function(t,e){var n=e.getSiblings().length+1;this.options.minCount>0&&n<=this.options.minCount?t.setStyle("display","none"):t.setStyle("display","inline")},deleteClick:function(t,e){e.getParent(".multicolumnwizard");if(e.getSiblings().length>0){e.getAllNext();level=e.getAllPrevious().length,e.dispose(),e.destroy.delay(10,e)}},upClick:function(t,e){this.killAllTinyMCE(t,e);var n=e.getPrevious();if(n){var a=n.getAllPrevious().length;n=this.updateRowAttributes(99999,n),e=this.updateRowAttributes(a,e),n=this.updateRowAttributes(a+1,n),e.inject(n,"before")}this.reinitTinyMCE(t,e,!1)},downClick:function(t,e){this.killAllTinyMCE(t,e);var n=e.getNext();if(n){var a=e.getAllPrevious().length;e=this.updateRowAttributes(99999,e),n=this.updateRowAttributes(a,n),(e=this.updateRowAttributes(a+1,e)).inject(n,"after")}this.reinitTinyMCE(t,e,!1)},clearElementValue:function(t){"checkbox"==t.get("type")||"radio"==t.get("type")?t.checked=!1:t.set("value","")}}),a.addOperationUpdateCallback("new",a.newUpdate),a.addOperationClickCallback("new",a.insertNewElement),a.addOperationUpdateCallback("delete",a.deleteUpdate),a.addOperationClickCallback("delete",a.deleteClick),a.addOperationClickCallback("up",a.upClick),a.addOperationClickCallback("down",a.downClick),function(t){t&&(t.openModalSelectorOriginal=t.openModalSelector,t.openModalSelector=function(e){t.openModalSelectorOriginal(e);var n=null,a=60,i=new URI(e.url).getData("field")+"_parent",o=setInterval((function(){a-=1;for(var t=window.frames,l=0;l<t.length;l++)if("simple-modal-iframe"==t[l].name){n=t[l];break}if(n&&n.document.getElementById(i))return n.document.getElementById(i).set("id",e.id+"_parent"),void clearInterval(o);a<=0&&clearInterval(o)}),500)})}(window.Backend),versionCompare=function(t){var e=$("top").get("class").match(/version_[^\s]*/);if("string"!=typeof(e=(e=(e=e[0]).replace("version_","")).split("-").join(".")))return!1;if(typeof t+typeof e!="stringstring")return!1;for(var n=t.split("."),a=e.split("."),i=0,o=Math.max(n.length,a.length);i<o;i++){if(n[i]&&!a[i]&&parseInt(n[i])>0||parseInt(n[i])>parseInt(a[i]))return 1;if(a[i]&&!n[i]&&parseInt(a[i])>0||parseInt(n[i])<parseInt(a[i]))return-1}return 0}},function(t,e,n){}]);